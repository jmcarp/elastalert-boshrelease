# This is the folder that contains the rule yaml files
# Any .yaml file will be loaded as a rule
rules_folder: /var/vcap/jobs/elastalert/data/rules

# How often ElastAlert will query elasticsearch
# The unit can be anything from weeks to seconds
run_every:
  minutes: <%= p("elastalert.run_every.minutes") %>

# ElastAlert will buffer results from the most recent
# period of time, in case some log sources are not in real time
buffer_time:
  minutes: <%= p("elastalert.buffer_time.minutes") %>

<%
  es_host = nil
  es_port = nil

  if_link('elasticsearch') do |link|
    es_host = link.instances.first.address
    es_port = link.p('elasticsearch.port')
  end

  unless es_host
    es_host = p('elastalert.elasticsearch.host')
  end
  unless es_port
    es_port = p('elastalert.elasticsearch.port')
  end
%>

# The elasticsearch hostname for metadata writeback
# Note that every rule can have its own elasticsearch host
es_host: <%= es_host %>

# The elasticsearch port
es_port: <%= es_port %>

# The index on es_host which is used for metadata storage
# This can be a unmapped index, but it is recommended that you run
# elastalert-create-index to set a mapping
writeback_index: elastalert_status

# If an alert fails for some reason, ElastAlert will retry
# sending the alert until this time period has elapsed
alert_time_limit:
  days: <%= p("elastalert.alert_time_limit.days") %>
